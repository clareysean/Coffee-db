<%- include('../partials/header') %>

<div class="coffee-card">
  <h4>Details</h4>
  <hr>
  <img class="google-icon" src="<%= coffee.user ? coffee.userAvatar : '/images/profile-user-svgrepo-com.svg' %>" referrerpolicy="no-referrer" alt="avatar">
  <h1><%= coffee.name %></h1>
  <h2><%= coffee.roaster %></h2>&nbsp;|&nbsp;<h2>Roast date: <%= coffee.roastDate.toISOString().slice(0, 10) %></h2>
  <h4>Reviewed by: <%= coffee.user ? coffee.userName : 'anonymous' %></h4>
  <p><%= coffee.initReview %></p>
  <h3>Aroma: <%= coffee.aroma %> </h3><h3>Acidity: <%= coffee.acidity %></h3><h3>Body: <%= coffee.bodyRating %> </h3><h3>Balance: <%= coffee.balance %></h3><h3>Sweetness: <%= coffee.sweetness %></h3>
  <% let total = coffee.aroma + coffee.acidity + coffee.bodyRating + coffee.balance + coffee.sweetness %>
  <% total *= 4 %>
  <h3>Overall: <%= total %> /100</h3>

  <img class="coffee-img" src="<%= coffee.imageUrl %>" alt="coffee image">
</div>
<hr>
<h4>Reviews</h4>
<hr>


    <!-- display reviews on coffee -->

    <%coffee.reviews.forEach((r)=>{%>
      <div class="review-card">
        <label for="avatar"><%=r.userName%><img alt="avatar" src="<%= r.userAvatar %>" referrerpolicy="no-referrer" ></label>
        <h2>Rating: <%=r.rating%> /5</h2>
        <p><%= r.content %></p>
        <% if (user?._id.equals(r.user)) { %>
            <form action="/review/<%= r._id %>?_method=DELETE" method="POST">
              <button type="submit">Delete your review</button>
            </form>
          <% } %>
      </div>
     <%})%>

     <%if(user){%>
     <form id="add-review-form" method="post"
     action="/coffee/<%= coffee._id %>/reviews">
     <label>Leave a review:</label>
     <label>Rating:</label>
     <select name="rating">
       <option value="1">1</option>
       <option value="2">2</option>
       <option value="3">3</option>
       <option value="4">4</option>
       <option value="5" selected>5</option>
     </select>
     <textarea name="content" cols="80" rows="10"></textarea> <br><br>
     <button class="landing-btns" type="submit" value="Add Review">Add Review</button> <br><br>
   </form>
<%}%>
<%if(!user){%>
  <h2>Log in to leave a review!</h2>
<%}%>

<%- include('../partials/footer') %>